#!/usr/bin/env ansible-playbook

---
- name: play 'testlink.ansible.role/setup.yml'
  hosts: all
  become: yes

  vars_files:
    - defaults/main.yml

  pre_tasks:
    - name: Add MySQL repository key
      apt_key: url=http://repo.mysql.com/RPM-GPG-KEY-mysql state=present
      when: ansible_distribution == 'Debian'
      
    - name: Add MySQL Server repository
      apt_repository: repo='deb http://repo.mysql.com/apt/debian/ {{ ansible_lsb.codename }} mysql-5.6' state=present
      when: ansible_distribution == 'Debian'

    - name: Add MySQL Python Connector repository
      apt_repository: repo='deb http://repo.mysql.com/apt/debian/ {{ ansible_lsb.codename }} connector-python-2.0' state=present
      when: ansible_distribution == 'Debian'
      
  roles:
    #- chusiang.switch-apt-mirror
    #- chusiang.vim-and-vi-mode
    - williamyeh.nginx
    - chusiang.php7
    - geerlingguy.mysql

  tasks:
    - name: rename hostname
      hostname: name=testlink.local
      when: ansible_virtualization_type != 'docker'

    - name: include main task
      include: tasks/main.yml

    - name: include check task
      include: tasks/check.yml

  post_tasks:
    # Run some tests.
    - include: tests/curl_testlink_web.yml
        
  handlers:
    - include: handlers/main.yml

# vim:ft=ansible:
